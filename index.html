<script>
    const basePath = "qsewr/dasf/erwq/reeqr/rwer/ewqr/tttt/";
    const imageFiles = [
        "29760928.png", "29761201.png", "29771201.png", "29780101-1.png", "29780101-2.png",
        "29780101-3.png", "29780101.png", "29780114.png", "29780213.png", "29780214.png",
        "29780301.png", "29780401.png", "29780402.png", "29780403.png", "29780415.png",
        "29780416.png", "2978041602.png", "2978041603.png", "2978041701.png", "29780418.png",
        "2978041802.png", "2978041901.png", "29780425.png", "29780426.png", "2978042602.png",
        "29780427.png", "2978042702.png", "2978042703.png", "29780428.png", "2978042901.png",
        "2978043001.png", "2978050301.png", "29780504.png", "29780507.png", "29780509.png",
        "29780520.png", "2978052001.png", "29780521.png", "29780522.png", "2978052202.png",
        "29780523.png", "29780525.png", "29780528.png", "2978052802.png", "29780529.png",
        "29780531.png", "2978053102.png", "29780602.png", "2978060202.png", "2978060203.png",
        "2978060301.png", "2978060302.png", "2978060401.png", "2978060402.png", "2978060403.png",
        "2978060404.png", "2978060405.png", "2978060406.png", "2978060407.png", "2978060408.png",
        "2978060409.png", "2978060410.png", "2978060411.png", "2978060412.png", "2978060501.png",
        "2978060502.png", "2978060503.png", "2978060601.png", "2978060602.png", "2978060701.png",
        "2978060702.png", "29780801.png", "29780802.png", "29780803.png", "29780804.png",
        "29780805.png", "29780806.png", "2978080602.png"
        // 如果还有更多，继续加
    ];

    const yearMap = { "2976": "1986", "2977": "1988", "2978": "1989" };

    const images = {};
    imageFiles.forEach(file => {
        const yearCode = file.slice(0, 4);
        const displayYear = yearMap[yearCode] || yearCode;
        if (!images[displayYear]) images[displayYear] = [];
        images[displayYear].push(`\( {basePath} \){file}`);
    });

    const yearList = document.getElementById('year-list');
    const imageBoard = document.getElementById('image-board').querySelector('.row');
    const pagination = document.getElementById('pagination');
    let currentYear = null;
    let currentYearImages = [];
    let currentPage = 1;
    const imagesPerPage = 2;
    let currentModalIndex = 0;

    // 生成年份链接并绑定点击
    Object.keys(images).sort().forEach(year => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = 'javascript:void(0)';
        a.textContent = year;
        a.addEventListener('click', () => {
            document.querySelectorAll('#year-list a').forEach(link => link.classList.remove('active'));
            a.classList.add('active');
            currentYear = year;
            currentYearImages = images[year];
            currentPage = 1;
            renderImages();
            renderPagination();
        });
        li.appendChild(a);
        yearList.appendChild(li);
    });

    // 默认加载第一个年份（如果有）
    if (Object.keys(images).length > 0) {
        yearList.querySelector('a').click();
    }

    function renderImages() {
        const start = (currentPage - 1) * imagesPerPage;
        const end = start + imagesPerPage;
        const pageImages = currentYearImages.slice(start, end);

        if (pageImages.length === 0) {
            imageBoard.innerHTML = '<p class="text-center col-12">该年份暂无图片</p>';
            return;
        }

        imageBoard.innerHTML = pageImages.map((src, i) => `
            <div class="col-12 col-lg-6">
                <img src="\( {src}" alt=" \){currentYear} 事件" class="img-fluid"
                     onclick="openModal(${start + i})" style="cursor:pointer;">
            </div>
        `).join('');
    }

    function renderPagination() {
        const totalPages = Math.ceil(currentYearImages.length / imagesPerPage);
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        pagination.innerHTML = `
            <button onclick="changePage(-1)" ${currentPage === 1 ? 'disabled' : ''}>上一页</button>
            <span>${currentPage} / ${totalPages}</span>
            <button onclick="changePage(1)" ${currentPage === totalPages ? 'disabled' : ''}>下一页</button>
            <input type="number" min="1" max="\( {totalPages}" value=" \){currentPage}" onchange="jumpTo(this.value)">
            <button onclick="jumpTo(document.querySelector('#pagination input').value)">跳转</button>
        `;
    }

    window.changePage = function(delta) {
        const newPage = currentPage + delta;
        if (newPage >= 1 && newPage <= Math.ceil(currentYearImages.length / imagesPerPage)) {
            currentPage = newPage;
            renderImages();
            renderPagination();
        }
    };

    window.jumpTo = function(page) {
        page = parseInt(page);
        const max = Math.ceil(currentYearImages.length / imagesPerPage);
        if (page >= 1 && page <= max) {
            currentPage = page;
            renderImages();
            renderPagination();
        }
    };

    window.openModal = function(index) {
        currentModalIndex = index;
        document.getElementById('modalImage').src = currentYearImages[index];
        const modal = new bootstrap.Modal(document.getElementById('imageModal'));
        modal.show();
    };

    // 键盘左右箭头切换大图
    document.addEventListener('keydown', e => {
        if (!document.querySelector('#imageModal').classList.contains('show')) return;
        if (e.key === 'ArrowLeft' && currentModalIndex > 0) {
            currentModalIndex--;
            document.getElementById('modalImage').src = currentYearImages[currentModalIndex];
        } else if (e.key === 'ArrowRight' && currentModalIndex < currentYearImages.length - 1) {
            currentModalIndex++;
            document.getElementById('modalImage').src = currentYearImages[currentModalIndex];
        }
    });
</script>
